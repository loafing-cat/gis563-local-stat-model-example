"0","# compute global ols moran's I to detect spatial autocorrelation"
"0",""
"0","# retrieve us county geometry"
"0","us_counties <- counties(cb = TRUE, year = 2021, class = 'sf')"
"0",""
"0","us_counties <- us_counties %>% "
"0","  select(GEOID, NAMELSAD, STUSPS, geometry)"
"0",""
"0","# retrive us state geometry and exclude some locations"
"0","us_states <- states(cb = TRUE, year = 2021, class = ""sf"") %>%"
"0","  st_transform(crs = 5070) %>% "
"0","  filter(STUSPS %nin% c('AK', 'HI', 'DC', 'MP', 'VI', 'PR', 'GU', 'AS'))"
"0",""
"0","# fix fip codes"
"0","mgwr_results <- add_fips_padding(df = mgwr_results)"
"0",""
"0","# merge datasets"
"0","df_merged <- mgwr_results %>% "
"0","  left_join(us_counties, by = c('fips_cd' = 'GEOID'))"
"0",""
"0","df_merged <- st_as_sf(df_merged)"
"0",""
"0","nb <- poly2nb(df_merged, queen = TRUE)"
"0",""
"0",""
"0","weights <- nb2listw(nb, style = 'W', zero.policy = TRUE)"
"0",""
"0","# ols Moran's I"
"0","ols_moran <- moran(df_merged$ols_residual, weights, length(nb), Szero(weights))[1]"
"0","# ols_moran"
"0",""
"0","ols_moran_test <- moran.test(df_merged$ols_residual, weights)"
